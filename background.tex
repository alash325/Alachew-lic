%%% Intro.tex --- 
%% 
%% Filename: Intro.tex
%% Description: 
%% Author: Ola Leifler
%% Maintainer: 
%% Created: Thu Oct 14 12:54:47 2010 (CEST)
%% Version: $Id$
%% Version: 
%% Last-Updated: Thu May 19 14:12:31 2016 (+0200)
%%           By: Ola Leifler
%%     Update #: 5
%% URL: 
%% Keywords: 
%% Compatibility: 
%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 
%%% Commentary: 
%% 
%% 
%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 
%%% Change log:
%% Completed Language Reading MBS
%% 
%% RCS $Log$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 
%%% Code:


\chapter{Background and Related Work}
\label{cha:background}

Cyber-Physical Systems (CPSs), systems composed of closely-coupled computing and physical elements, are characterized by a complex architecture and a design process involving different science and engineering disciplines. Model-Based Design (MBD), emphasizes mathematical modeling to design, analyze, verify, and validate dynamic systems, and has been identified as a powerful design technique for \acrshort{cps} \cite{mbsdbalasubramanian,mbsdbrooks,mbsdkarasi}. However, due to the intrinsic heterogeneity and complexity of \acrshort{cps}, a large number of modeling languages and tools have been utilized to address different aspects of the system such as physical processes and requirements management.

In the previous decade, several \acrshort{eoo} languages used for mathematical modeling of heterogeneous dynamics of complex \acrshort{cps} (e.g., automobiles, aircraft, and powerplants), have gained considerable attention from both industry and academia. Today the state of the art within multi-domain physical modeling (e.g., containing mechanical, electrical, hydraulic, thermal, fluid, and control components) is Modelica \cite{modelica}, which is an \acrshort{eoo} modeling language for declarative mathematical modeling of large physical systems \cite{modelicahilding,modelicapeter,modelicapeterbook,modelicatiller}. 

Other examples of languages with similar modeling and simulation capabilities are gPROMS \cite{gproms,gpromsbarton,gpromsoh,gpromspaulphd} for chemical engineering, VHDL-AMS \cite{vhdlamsernst,vhdlamsieee}, which is a hardware description language (HDL) for modeling of modern analog and mixed-signal designs, ADAMS \cite{adams} in the domain of mechanical modeling, SKF’s \acrshort{beast} \cite{beast} for simulation of the dynamics of rolling bearing models with detailed contact definitions, and control systems in Simulink \cite{simulink}. High level UML-based languages such as SysML \cite{sysml,sysmlmorgan} and ModelicaML \cite{modelicaml,modelicamlreport,modelicamlverification,modelicamlwladimir} have also been utilized for modeling CPSs for design phases such as simulation and verification.

Recently, co-simulation technologies such as Functional Mock-up Interface (FMI) \cite{fmi, fmiblochwitz} and Transmission Line Modeling (TLM)-based co-simulation techniques \cite{tlmkurs90,tlmcogan,tlmjohns,tlmkurs99} have also been utilized for modeling and simulating individual components of complex distributed CPSs, using different simulation tools simultaneously and collaboratively. Thus, system engineers can use different simulation tools together to create virtual prototypes of entire Cyber-Physical Systems. 

\section{Modelica}
\label{sec:modelica}


Modelica \cite{modelica, modelicapeterbook, modelicapeter} is a freely available, object-oriented, declarative and equation-based language for component-oriented modeling of large, complex, and heterogeneous systems. It is suited for component-oriented multi-domain modeling of physical systems, for example, systems containing electrical, electric power, mechanical, hydraulic, thermal, control, state machine subsystems, or process-oriented subcomponents. 
The open standard Modelica language specification is developed by a non-profit organization, the Modelica Association \cite{modelicaassociation}. The Modelica Association also develops the open-source Modelica Standard Library (MSL) \cite{modelicamsl} with a large set of models. \acrshort{msl} version 3.2.2 \cite{modelica, modelicamsl} contains about 1600 model components and 1350 functions from different application domains. Libraries of model components are described by object diagrams, which consist of connected components. Components are connected by ports and are defined by subcomponents or a textual description in the Modelica language based on standardized interface definitions.
Models in Modelica are built on acausal modeling and object-oriented constructs with mathematical equations described by differential, algebraic, and discrete equations to facilitate exchange and re-use of models. Thus, no particular variable needs to be solved for manually. A Modelica tool will have enough information to automatically determine the computational solution order and generate efficient simulation code.

Modelica, which is suited for hardware-in-the-loop simulations and for embedded control systems, is increasingly used for model-based development in industry. In particular, many automotive companies, such as Audi, BMW, Daimler, Ford, Toyota, and VW use Modelica to design energy efficient vehicles and/or improved air conditioning systems. Also, power plant providers, such as ABB, EDF, and Siemens use Modelica, as do many other companies.

A number of commercial and open-source simulation environments are available that support modeling with Modelica, such as Wolfram SystemModeler \cite{wolfram, wolframmats, wolframpeter}, Dymola \cite{dymola, dymoladag}, SimulationX \cite{simulationx}, MapleSim \cite{maplesim}, OpenModelica \cite{openmodelica,openmodelicapeter} JModelica.org \cite{jmodelica}, and more. 


\section{OpenModelica}
\label{sec:openmodelica}

OpenModelica \cite{openmodelica,openmodelicapeter} is an extensible Modelica-based open-source framework for modeling, simulation, and analysis of dynamic systems intended for research, teaching, and industrial usage. It is a result of research at the Programming Environments Laboratory (PELAB), Link\"{o}ping University, and its long-term development is supported by a non-profit organization, the open-source Modelica Consortium (OSMC) \cite{osmc}. The main objective of the OpenModelica effort is to create a flexible and comprehensive Modelica modeling, compilation, simulation and systems engineering environment for research, teaching, and industrial usage.

The OpenModelica environment consists of several subsystems. An advanced interactive OpenModelica Compiler (OMC) performs the translation of Modelica models to C code, which is compiled and executed to simulate the model. Textual and graphical model editing, including browsing of the Modelica standard library, simulating, analyzing simulations, and presenting documentation is performed using the OpenModelica connection editor (OMEdit). The OpenModelica Notebook (OMNotebook) provides a tutorial for Modelica, and Modelica models, together with documentation and pictures, can be written and simulated in it. Debuggers for equation-based modeling and for algorithmic subsets of Modelica are supported in OpenModelica. OpenModelica currently supports \acrshort{fmi} 1.0 and \acrshort{fmi} 2.0 for model exchange and most of FMI 2.0 for co-simulation. Other tools can access this functionality by dynamically linking OMC or by invoking it using a message-passing interface. For more information, see the openmodelica.org\cite{openmodelica} home page.

Recent research developments of the OpenModelica environment reported in this thesis include co-modeling and simulation based on \acrshort{tlm}, model-based dynamic optimization integration with CasADi \cite{casadi} for solving large-scale optimization problems, seamless tracing of the requirements and associating them with the models and the simulation results, and better interoperability with Python for advanced modeling simulation analysis.


\section{Model-Based Systems Engineering (MBSE)}
\label{sec:mbse}

Model-Based Systems Engineering (MBSE) is defined in \cite{mbsdincose} as “the formalized application of modeling to support system requirements, design, analysis, verification, and validation activities, beginning in the conceptual design phase and continuing throughout development and later life cycle phases.” An overview of existing methodologies used in industry is given in \cite{mbsdestefan}. Some of these methodologies use standardized languages, such as \acrshort{uml} \cite{uml}, or SysML \cite{sysml} for system modeling. 
More recently, there has been increased focus on using a system model as an executable specification to numerically evaluate the dynamic behavior of complex systems throughout the development process. For example, ModelicaML \cite{modelicaml, modelicamlreport}, an extended SysML-based profile for system modeling, can be combined with Modelica to enable the modeling and simulation of complex heterogeneous \acrshort{cps}. An example of model-based design methodology for \acrshort{cps} is given in \cite{mbsdjensen}.


\section{UML-Based System Modeling Languages}
\label{sec:uml}
 
The Unified Modeling Language (UML) \cite{uml} is a general-purpose visual modeling language for architectural modeling, design, and implementation of complex software systems, both structurally and behaviorally. The static structure of a software system is captured in \acrshort{uml} through a combination of class diagrams, and/or composite structure diagrams. The dynamic behavior of a software system is captured in \acrshort{uml}-based specialized languages (e.g., \acrshort{sysml}\cite{sysml,sysmlmorgan} and ModelicaML\cite{modelicaml, modelicamlreport} through a combination of sequence diagrams, activity diagrams, and/or state machine diagrams and their own specific extensions, using a \acrshort{uml} profile to adapt the language to a particular domain or purpose. 

\subsection{SysML}
\label{sec:sysml}


The Systems Modeling Language (SysML) \cite{sysml} is a graphical modeling language that is based on \acrshort{uml} for Systems Engineering.It is defined as an extension of a subset of the \acrshort{uml}, using \acrshort{uml}\'s profile mechanism. Through these extensions, \acrshort{sysml} supports the specification, analysis, design, verification, and validation of complex systems that may include hardware and software. In particular, the language provides graphical representations with a semantic foundation for modeling system requirements, behavior, structure, and parametrics, which are used to integrate with other engineering analysis models. However, \acrshort{sysml} models are not executable in a manner that allows them to interoperate with other model simulation and analysis tools. An extended version of SysML to support modeling of complex heterogeneous \acrshort{cps} is given in \cite{mbsdjensen}. 

\subsection{ModelicaML}
\label{sec:modelicaml}

Modelica Modeling Language (ModelicaML) \cite{modelicaml, modelicamlreport} is a graphical modeling language for the description of continuous-time and discrete-time/event-based system dynamics. ModelicaML is defined as an extended subset of \acrshort{uml} and a language extension for Modelica. This subset enables the generation of executable Modelica code from graphical models.

ModelicaML extends the graphical modeling capabilities of Modelica by providing more diagrams (\acrshort{uml} diagrams for presenting the composition, connection, inheritance, or behavior of classes) for graphical model definition or documentation. Parts of the system model are entered as text (i.e., Modelica equations or algorithmic code, modification and declaration expressions). Moreover, ModelicaML supports a method for formalizing and verifying system requirements using simulations via the vVDR\footnote{https://github.com/lenaRB/VVDRlib} (Virtual Verification of Designs against Requirements) method.The vVDR method (See Chapter 3 in \cite{modelicamlwladimir, modelicamlverification}) enables model-based design verification against system requirements.


\section{Modeling and Simulation Tools}
\label{sec:tools}

\subsection{Wolfram SystemModeler}
\label{sec:wolfram}

Wolfram SystemModeler \cite{wolfram, wolframmats, wolframpeter} is a commercial platform, developed by Wolfram MathCore [Wolfram MathCore Engineering AB, 2007], for modeling and simulation of Modelica models based on an older version of the OpenModelica compiler front-end. It provides an interactive graphical modeling editor, simulation, and plotting environment and a customizable set of component libraries. In addition, SystemModeler has a link to Mathematica \cite{mathematica}, which enables further analysis and transformation of Modelica models.

\subsection{MATLAB/Simulink}
\label{sec:simulink}

Simulink \cite{simulink} is an extension to MATLAB for graphical modeling, simulation, and model-based design of multi-domain dynamic systems. Mathematical models representing physical systems are represented graphically in Simulink as block diagrams. It supports system-level design, simulation, automatic code generation, and continuous test and verification of embedded systems.
Simulink is tightly integrated with the MATLAB environment, enabling users to incorporate MATLAB algorithms into models and export simulation results to MATLAB for further analysis. It is widely used in automatic control and digital signal processing for multi-domain simulation and Model-Based Design \cite{simulinkchristian,simulinkreedy}. Compared to Modelica, Simulink only supports causal modeling, and a Simulink model for a specific data flow context cannot be reused for another data flow context.

\subsection{Dymola}
\label{sec:dymola}

Dymola \cite{dymola,dymoladag}, developed by Dassault Systemes\footnote{https://www.3ds.com/products-services/catia/products/dymola}, is a commercial modeling and simulation tool based on the Modelica modeling language for model-based design of complex systems. In addition, Dymola supports \acrshort{fmi} 1.0 and 2.0 for model exchange and co-simulation, model calibration, parameter optimization, and real-time simulation for a wide range of hardware-in-the-loop platforms.

\subsection{20-Sim}
\label{susec:20sim}


20-sim\footnote{http://www.20sim.com/} is a commercial tool for modeling and simulation of mechatronic systems. It is widely used to simulate and analyze the behavior of multi-domain dynamic systems and the development of control systems \cite{20sim,20simduindam,20simjan}. The 20-sim tool can represent continuous time models using equations, block diagrams, physical components, and bond graphs. Bond graphs \cite{20simgawthrop}, a domain-independent description of a physical system's dynamics, implement such connected blocks.


\subsection{Overture}
\label{sec:overture}

Overture\footnote{http://overturetool.org/} is an open-source integrated development environment for modeling and analyzing VDM (The Vienna Development Method)\footnote{http://overturetool.org/method/ - Model-oriented formal methods for the development of computer-based systems and software} models. Typically, it supports \cite{overtureverhoef} the design of discrete systems using VDM-RT (VDM-Real Time)\footnote{http://overturetool.org/download/examples/VDMRT/ - A real-time dialect of the VDM formal modeling language} dialect, including both time and distribution of functionality on different computational nodes for \acrshort{cps}.


\subsection{ADAMS}
\label{sec:adams}

ADAMS (Automated Dynamic Analysis of Mechanical Systems) \cite{adams} is a multibody dynamics simulation environment for building, simulating, and refining models of mechanical systems. It is equipped with Fortran and C++-based numerical solvers. 

\subsection{Modelio}
\label{sec:modelio}

Modelio \cite{modelio} is an open-source modeling tool supporting industry standards like \acrshort{uml} and its extensions \acrshort{sysml} for high-level system architecture modeling. Modelio extends the SysML language \cite{sysml, sysmlmorgan} and proposes extensions for \acrshort{cps} modeling, enabling the specification of several aspects of the system from requirements to the hardware/software architecture through use case specification, and system functional design. In particular, requirement, \acrshort{fmi} interface, \acrshort{fmu} connections, automatic documentation generation, and impact analysis are supported. 

\subsection{RT-Tester}
\label{sec:rttester}

RT-Tester \cite{rttester,rttester11} is a test automation tool for automatic test generation, test execution, and real-time test evaluation. The RT-Tester Model-Based Test Case and Test Data Generator(RTT-MBT) \cite{rttester,rttester13} supports model-based testing: automated generation of test cases, test data, and test procedures from \acrshort{uml}/\acrshort{sysml} models. Additionally, it generates tests as FMUs that are executed against the system under test, and also generates traceability data that relates requirements, test cases, test procedures, and results.

\subsection{BEAST}
\label{sec:beast}

BEAST (BEAring Simulation Tool) \cite{beast}, developed by SKF\footnote{http://www.skf.com/se/index.html}, is a simulation program that enables SKF engineers to perform simulations of bearing dynamics on any major bearing types. This enables studies of internal motions and forces in a bearing under virtually any load condition. The model is fully three-dimensional, solving the general differential equations of motion for all components; all components have six degrees of freedom. External forces and moments can be applied to all bearing components except the rolling elements. Most bearing types can be modeled.

\subsection{PySimulator}
\label{sec:pysimulator}

PySimulator \cite{pysimulator} is a simulation and analysis environment in Python with plugin infrastructure. The environment provides a graphical user interface for simulating different model types (currently Functional Mockup Units, Modelica Models and SimulationX Models), plotting result variables and applying simulation result analysis tools like Fast Fourier Transform. The modular concept of the software enables easy development of further plugins for both simulation and analysis. 

\section{Co-simulation Technologies}
\label{sec:cosimulaiton}


\subsection{Functional Mock-up Interface (FMI)}
\label{sec:fmi}

The Functional Mock-up Interface (FMI) \cite{fmi,fmiblochwitz} is an open and tool-independent standardized interface for exchange between tools and co-simulation of dynamic models. FMI defines a C interface that is implemented by an executable called a Functional Mock-up Unit (FMU). The idea is to allow tools to export pre-compiled system models containing the model description eXtensible Markup Language (XML) file and model equations in C-code or binary code, and to exchange models that comply with the FMI specification. 

The FMI standard currently specifies two types of protocols: \acrshort{fmi} for Model Exchange (import and export), and FMI for co-simulation. The main difference between these two protocols is that in Model Exchange the \acrshort{fmu} is simulated using the importing tool's solver, while in co-simulation the \acrshort{fmu} is shipped with its own solver to couple two or more simulation tools in a co-simulation environment. 
The \acrshort{fmi} standard is currently supported by over 106 modeling and simulation tools\footnote{http://fmi-standard.org/tools/}, for example Dymola\footnote{https://www.3ds.com/products-services/catia/products/dymola}, Wolfram SystemModeler\footnote{http://wolfram.com/system-modeler/}, OpenModelica\footnote{https://openmodelica.org/}, and Jmodelica.org\footnote{http://www.jmodelica.org/}.

\subsection{Transmission Line Modeling (TLM)}
\label{sec:tlm}

The transmission line element method (TLM) \cite{tlmkurs90,tlmkurs99,tlmcogan,tlmjohns} is a one-dimensional simulation technique for power transmitting systems. This means systems where the physical behavior can be modeled with intensity and flow variables, for example hydraulics, electrics, mechanics, and acoustics. The method, also known as bi-lateral delay line modeling \cite{tlmauslander}, was used in transmission line modeling as described by \cite{tlmjohns}. The difference between TLM and other simulation methods based on centralized integration is that it uses time delays in the model to simulate how the information propagates through the system. Information propagation is thus simulated more accurately than with other methods, because physically motivated time delays are taken into account. This is especially useful when accurate wave propagation results are important. The use of time delays also means that all components are separated by some distance. There is no immediate communication taking place between components separated in time. This makes \acrshort{tlm} ideal for parallel or distributed processing.

\section{Dynamic Optimization}
\label{sec:dynamicoptimization}

\subsection{CasADi}
\label{sec:casadi}

CasADi \cite{casadi} is an open-source framework for C++ and Python for numerical optimization in general and optimal control in particular. The main idea of the tool is to provide users with the ability to easily and efficiently implement optimal control algorithms with a wide range of methods, including multiple shooting and collocation, rather than providing users with a “black-box” \acrshort{ocp} solver.

\section{Related Work}
\label{sec:relatedwork}

Due to the influence of high-level equation-based modeling languages in the industrial community, there have been several attempts to integrate tools for such languages with numerical algorithms for optimization. However, most available tools usually only support a particular optimization algorithm. For example, Dymola supports parameter and design optimization of models written in Modelica, whereas JModelica.org, presented in \cite{akesson}, and OpenModelica, presented in \cite{bernhard}, have native support for optimal control. Several other applications of dynamic optimization of Modelica models have been reported, e.g., \cite{relatedworkjohan,relatedworkfranke, relatedworklarson,relatedworkjan, relatedworkprolss}. 

gPROMS \cite{gproms} supports dynamic optimization, both a single shooting and a multiple shooting algorithm, intended for chemical engineering applications. In comparison with Modelica, which partially supports Partial Differential Equations (PDEs) \cite{pdelevon,pdelevonpeter}, gPROMS supports PDEs more extensively using the method of lines. ACADO \cite{acado,acadoboris} is a numerical package based on Ipopt \cite{wachter,ipopt}, for automatic control and dynamic optimization of direct optimal control including model predictive control, state and parameter estimation, and robust optimization. While ACADO offers state of the art algorithms, formulating the model and optimization descriptions are not supported by a graphical user interface. 

During recent decades, different co-simulation technologies and frameworks have emerged. For example, Cosimate \cite{tnisoftware}, Ptolemy-II \cite{cosimulationptolemy}, MILAN \cite{cosimulationmilan}, and the integrated co-simulation environment for heterogeneous systems prototyping \cite{cosimulationyongjoo}. Most of them are focused on co-simulation of control systems and mechanical components, hardware-software co-simulation, or embedded system simulation. 

The HOPSAN \cite{hopsanusersguide} software is one of the first general TLM-based co-simulation implementations with its own graphical modeling language. A newer version, HOPSAN-NG \cite{hospanaxin}, has recently been developed. Moreover, a TLM implementation for the Modelica language has recently been developed as part of OpenModelica (See Chapter 7 in \cite{tlmmartin}).

A meta-modeling approach for TLM-based co-simulation has been also developed in \cite{tlmalexander05} and extended later in \cite{tlmsiemers06,tlmsiemers07} to better support composite modeling for mechanical system simulations. More recently, the work presented in \cite{tlmsiemers09} supports a fully functional composite model coupled simulation environment that supports integration of many different simulation tool-specific models into a co-simulation (Note: the term "meta-model" is used in some of these papers with a meaning defined as "composite model"). The most important consideration in such coupled simulation is numerical stability for solvers using variable time steps, as well as to make co-simulation modeling applicable for a wider range of tools. However, it is limited to in-house usage at SKF and also lacks advanced graphical modeling and validation to assist users in the early phases of co-simulation modeling. Therefore, an additional goal in the development of TLM-based co-simulation tools is to provide an open-source tool for advanced graphical and textual co-modeling simulation, including validation.

A tool for accessing Modelica from Python, OMPython \cite{ompythonanandthesis}, has been developed. It communicates with OpenModelica via CORBA. OMPython is a Python package which makes it possible to pass OpenModelica Shell commands as strings to a Python function, and then receive the results back into Python. However, this requires good knowledge of OpenModelica Shell commands and syntax. 

A simulation and analysis tool, PySimulator, has been developed to ease the use of Modelica from Python \cite{pysimulator}. Essentially, PySimulator provides a GUI based on Python, which allows running of Modelica models and presentation of the results. It is also possible to analyze the results using various packages in Python, e.g., \acrshort{fft} analysis. However, PySimulator does not currently give the user full freedom to integrate Modelica models with Python and use the full available set of packages in Python, or to freely develop analysis routines in Python.

The free JModelica.org tool includes a Python package for converting Modelica models to FMUs, and then for importing the FMU as a Python object. This way, Modelica models can essentially be simulated from Python — Optimica is also supported. It is possible to do more advanced analysis with JModelica.org via CasADi, see, e.g., \cite{pythonperera} and \cite{pythonpereraparameter}. However, the functionalities in \cite{pythonperera} use an old version of JModelica.org. It would be more useful if these functionalities were supported by the tool developer.


%\nocite{scigen}
%We have included Paper \ref{art:scigen}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Intro.tex ends here


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "demothesis"
%%% End: 
